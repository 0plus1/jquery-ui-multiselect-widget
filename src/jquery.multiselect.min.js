/*
 * jQuery MultiSelect UI Widget 1.4.1
 * Copyright (c) 2010 Eric Hynds
 *
 * http://www.erichynds.com/jquery/jquery-ui-multiselect-widget/
 *
 * Depends:
 *   - jQuery 1.4.2
 *   - jQuery UI 1.8 (widget factory and effects if you want to use them)
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
*/
(function(d){var o=0;d.widget("ech.multiselect",{options:{header:true,height:175,minWidth:225,checkAllText:"Check all",uncheckAllText:"Uncheck all",noneSelectedText:"Select options",selectedText:"# selected",selectedList:0,show:"",hide:"",autoOpen:false,multiple:true,position:{}},_create:function(){var c=this.element,b=this.options,a=[],e=[],f=c.attr("title"),i=c.id||o++,p=c.attr("name");this.speed=400;this._isOpen=false;a.push('<button type="button" class="ui-multiselect ui-widget ui-state-default ui-corner-all"'); f.length&&a.push(' title="'+f+'"');a.push('><span class="ui-icon ui-icon-triangle-2-n-s"></span><span>'+b.noneSelectedText+"</span></button>");a.push('<div class="ui-multiselect-menu ui-widget ui-widget-content ui-corner-all">');a.push('<div class="ui-widget-header ui-corner-all ui-multiselect-header ui-helper-clearfix">');a.push('<ul class="ui-helper-reset">');if(b.header===true){a.push('<li><a class="ui-multiselect-all" href="#"><span class="ui-icon ui-icon-check"></span><span>'+b.checkAllText+ "</span></a></li>");a.push('<li><a class="ui-multiselect-none" href="#"><span class="ui-icon ui-icon-closethick"></span><span>'+b.uncheckAllText+"</span></a></li>")}else typeof b.header==="string"&&a.push("<li>"+b.header+"</li>");a.push('<li class="ui-multiselect-close"><a href="#" class="ui-multiselect-close"><span class="ui-icon ui-icon-circle-close"></span></a></li>');a.push("</ul>");a.push("</div>");a.push('<ul class="ui-multiselect-checkboxes ui-helper-reset">');c.find("option").each(function(j){var h= d(this),l=h.html(),m=this.value;j=this.id||"ui-multiselect-"+i+"-option-"+j;var g=h.parent(),k=h.is(":disabled"),n=["ui-corner-all"];if(g.is("optgroup")){g=g.attr("label");if(d.inArray(g,e)===-1){a.push('<li class="ui-multiselect-optgroup-label"><a href="#">'+g+"</a></li>");e.push(g)}}if(m.length>0){k&&n.push("ui-state-disabled");a.push('<li class="'+(k?"ui-multiselect-disabled":"")+'">');a.push('<label for="'+j+'" class="'+n.join(" ")+'"><input id="'+j+'" type="'+(b.multiple?"checkbox":"radio")+ '" name="'+p+'" value="'+m+'" title="'+l+'"');if(h.is(":selected")){a.push(' checked="checked"');h.removeAttr("selected")}k&&a.push(' disabled="disabled"');a.push(" />"+l+"</label></li>")}});a.push("</ul></div>");this.button=c.hide().after(a.join("")).next("button");this.menu=this.button.next("div.ui-multiselect-menu");this.labels=this.menu.find("label");this.buttonlabel=this.button.find("span").eq(-1);this._setButtonWidth();this._setMenuWidth();this._bindEvents();this.button[0].defaultValue=this.update()}, _init:function(){this.options.header||this.menu.find("div.ui-multiselect-header").hide();this.options.autoOpen&&this.open();this.element.is(":disabled")&&this.disable()},_bindEvents:function(){function c(a){b[b._isOpen?"close":"open"]();a.preventDefault()}var b=this;this.button.find("span").bind("click",c);this.button.bind({click:c,keypress:function(a){switch(a.keyCode){case 27:case 38:case 37:b.close();break;case 39:case 40:b.open()}},mouseenter:function(){b.button.hasClass("ui-state-disabled")|| d(this).addClass("ui-state-hover")},mouseleave:function(){d(this).removeClass("ui-state-hover")},focus:function(){b.button.hasClass("ui-state-disabled")||d(this).addClass("ui-state-focus")},blur:function(){d(this).removeClass("ui-state-focus")}});this.menu.find("div.ui-multiselect-header a").bind("click",function(a){d(this).hasClass("ui-multiselect-close")?b.close():b[d(this).hasClass("ui-multiselect-all")?"checkAll":"uncheckAll"]();a.preventDefault()}).end().find("li.ui-multiselect-optgroup-label a").bind("click", function(a){var e=d(this),f=e.parent().nextUntil("li.ui-multiselect-optgroup-label").find("input:visible");b._toggleChecked(f.filter(":checked").length!==f.length,f);b._trigger("optgrouptoggle",a,{inputs:f.get(),label:e.parent().text(),checked:f[0].checked});a.preventDefault()}).end().delegate("label","mouseenter",function(){if(!d(this).hasClass("ui-state-disabled")){b.labels.removeClass("ui-state-hover");d(this).addClass("ui-state-hover").find("input").focus()}}).delegate("label","keydown",function(a){switch(a.keyCode){case 9:case 27:b.close(); break;case 38:case 40:case 37:case 39:b._traverse(a.keyCode,this);break;case 13:a.preventDefault();d(this).find("input").trigger("click")}}).delegate("input","click",function(a){var e=this.checked;d(this).is(":disabled")||b._trigger("click",a,{value:this.value,text:this.title,checked:e})===false?a.preventDefault():b.update(!a.originalEvent?e?-1:1:0)});d(document).bind("click",function(a){a=d(a.target);b._isOpen&&!a.closest("div.ui-multiselect-menu").length&&!a.is("button.ui-multiselect")&&b.close()})}, _setButtonWidth:function(){var c=this.element.outerWidth(),b=this.options;if(/\d/.test(b.minWidth)&&c<b.minWidth)c=b.minWidth;this.button.width(c)},_setMenuWidth:function(){var c=this.menu,b=this.button.outerWidth()-parseInt(c.css("padding-left"),10)-parseInt(c.css("padding-right"),10)-parseInt(c.css("border-right-width"),10)-parseInt(c.css("border-left-width"),10);c.width(b||this.button.outerWidth())},_traverse:function(c,b){var a=d(b),e=c===38||c===37?true:false;a=a.parent()[e?"prevAll":"nextAll"]("li:not(.ui-multiselect-disabled, .ui-multiselect-optgroup-label)")[e? "last":"first"]();if(a.length)a.find("label").trigger("mouseover");else{a=this.menu.find("ul:last");this.menu.find("label")[e?"last":"first"]().trigger("mouseover");a.scrollTop(e?a.height():0)}},_toggleChecked:function(c,b){(b&&b.length?b:this.labels.find("input")).not(":disabled").attr("checked",c?"checked":"");this.update()},_toggleDisabled:function(c){this.button.attr("disabled",c?"disabled":"")[c?"addClass":"removeClass"]("ui-state-disabled");this.menu.find("input").attr("disabled",c?"disabled": "").parent()[c?"addClass":"removeClass"]("ui-state-disabled");this.element.attr("disabled",c?"disabled":"")},update:function(){var c=this.options,b=this.labels.find("input"),a=b.filter(":checked"),e=a.length;c=e===0?c.noneSelectedText:d.isFunction(c.selectedText)?c.selectedText.call(this,e,b.length,a.get()):/\d/.test(c.selectedList)&&c.selectedList>0&&e<=c.selectedList?a.map(function(){return this.title}).get().join(", "):c.selectedText.replace("#",e).replace("#",b.length);this.buttonlabel.html(c); return c},open:function(){if(!(this._trigger("beforeopen")===false||this.button.hasClass("ui-state-disabled")||this._isOpen)){d(":ech-multiselect").not(this.element).each(function(){var i=d(this);i.multiselect("isOpen")&&i.multiselect("close")});var c=this.menu.find("ul:last"),b=this.options,a=b.show,e=this.speed,f=this.button.position();if(d.isArray(b.show)){a=b.show[0];e=b.show[1]||this.speed}c.scrollTop(0).height(b.height);if(d.ui.position&&!d.isEmptyObject(b.position)){b.position.of=b.position.of|| this.button;this.menu.show().position(b.position).hide().show(a,e)}else this.menu.css({top:f.top+this.button.outerHeight(),left:f.left}).show(a,e);this.labels.eq(0).trigger("mouseover").trigger("mouseenter").find("input").trigger("focus");this.button.addClass("ui-state-active");this._isOpen=true;this._trigger("open")}},close:function(){if(this._trigger("beforeclose")!==false){var c=this.options,b=c.hide,a=this.speed;if(d.isArray(c.hide)){b=c.hide[0];a=c.hide[1]||this.speed}this.menu.hide(b,a);this.button.removeClass("ui-state-active").trigger("blur").trigger("mouseleave"); this._trigger("close");this._isOpen=false}},enable:function(){this._toggleDisabled(false)},disable:function(){this._toggleDisabled(true)},checkAll:function(){this._toggleChecked(true);this._trigger("checkAll")},uncheckAll:function(){this._toggleChecked(false);this._trigger("uncheckAll")},getChecked:function(){return this.menu.find("input").filter(":checked")},destroy:function(){d.Widget.prototype.destroy.call(this);this.button.remove();this.menu.remove();this.element.show();this.element.val(this.menu.find("input:checked").map(function(){return this.value})); return this},isOpen:function(){return this._isOpen},widget:function(){return this.menu},_setOption:function(c,b){this.options[c]=b;switch(c){case "header":this.menu.find("div.ui-multiselect-header")[b?"show":"hide"]();break;case "checkAllText":this.menu.find("a.ui-multiselect-all span").eq(-1).text(b);break;case "uncheckAllText":this.menu.find("a.ui-multiselect-none span").eq(-1).text(b);break;case "height":this.menu.find("ul:last").height(parseInt(b,10));break;case "minWidth":this.options[c]=parseInt(b, 10);this._setButtonWidth();this._setMenuWidth();break;case "selectedText":case "selectedList":case "noneSelectedText":this.update()}}})})(jQuery);